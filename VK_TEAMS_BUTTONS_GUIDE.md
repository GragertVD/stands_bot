# üîò VK Teams Bot - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∫–Ω–æ–ø–∫–∞–º

–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É **inline-–∫–Ω–æ–ø–æ–∫** –≤ VK Teams —Å–æ–≥–ª–∞—Å–Ω–æ [–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ VK Teams Bot API](https://teams.vk.com/botapi/tutorial/).

## üìã –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–∏–ø—ã –∫–Ω–æ–ø–æ–∫:
- **Callback –∫–Ω–æ–ø–∫–∏** - –≤—ã–ø–æ–ª–Ω—è—é—Ç –¥–µ–π—Å—Ç–≤–∏–µ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏
- **URL –∫–Ω–æ–ø–∫–∏** - –æ—Ç–∫—Ä—ã–≤–∞—é—Ç —Å—Å—ã–ª–∫—É –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- **–ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã** - –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–Ω–æ–ø–æ–∫ –≤ —Ä—è–¥–∞—Ö

### ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å N8N:
- –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–Ω–æ–ø–æ–∫ —á–µ—Ä–µ–∑ webhook –æ—Ç N8N
- –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –Ω–∞–∂–∞—Ç–∏–π –∫–Ω–æ–ø–æ–∫ –≤ N8N
- –ü–æ–ª–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–µ–π

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ N8N Webhook

```bash
curl -X POST http://localhost:8000/api/webhook \
  -H "Content-Type: application/json" \
  -d '{
    "chat_id": "user@vkteam.ru",
    "message": "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:",
    "message_type": "text",
    "buttons": [
      {
        "text": "‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å",
        "callback_data": "confirm"
      },
      {
        "text": "‚ùå –û—Ç–º–µ–Ω–∏—Ç—å", 
        "callback_data": "cancel"
      },
      {
        "text": "üîó –û—Ç–∫—Ä—ã—Ç—å —Å—Å—ã–ª–∫—É",
        "url": "https://example.com"
      }
    ]
  }'
```

### 2. –ü—Ä—è–º–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ API

```bash
curl -X POST http://localhost:8000/api/send-message \
  -H "Content-Type: application/json" \
  -d '{
    "chat_id": "user@vkteam.ru",
    "message": "–í—ã–±–µ—Ä–∏—Ç–µ –æ–ø—Ü–∏—é:",
    "buttons": [
      {"text": "–û–ø—Ü–∏—è 1", "callback_data": "option_1"},
      {"text": "–û–ø—Ü–∏—è 2", "callback_data": "option_2"}
    ]
  }'
```

### 3. –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –∫–Ω–æ–ø–∫–∏ –∫ –∫–æ–º–∞–Ω–¥–∞–º:

- **`/start`** - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é —Å –∫–Ω–æ–ø–∫–∞–º–∏
- **`/help`** - —Å–ø—Ä–∞–≤–∫–∞ —Å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–º–∏ –∫–Ω–æ–ø–∫–∞–º–∏  
- **`/status`** - —Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã —Å –∫–Ω–æ–ø–∫–∞–º–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- **–≠—Ö–æ-—Å–æ–æ–±—â–µ–Ω–∏—è** - –≤–∫–ª—é—á–∞—é—Ç –∫–Ω–æ–ø–∫—É "–ü–æ–≤—Ç–æ—Ä–∏—Ç—å"

## üìö –§–æ—Ä–º–∞—Ç –∫–Ω–æ–ø–æ–∫

### Callback –∫–Ω–æ–ø–∫–∞
```json
{
  "text": "–ù–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–æ–ø–∫–∏",
  "callback_data": "action_name"
}
```

### URL –∫–Ω–æ–ø–∫–∞  
```json
{
  "text": "–û—Ç–∫—Ä—ã—Ç—å —Å—Å—ã–ª–∫—É",
  "url": "https://example.com"
}
```

### –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
```json
{
  "chat_id": "user@vkteam.ru",
  "message": "–í—ã–±–µ—Ä–∏—Ç–µ:",
  "buttons": [
    {"text": "–ö–Ω–æ–ø–∫–∞ 1", "callback_data": "btn1"},
    {"text": "–ö–Ω–æ–ø–∫–∞ 2", "callback_data": "btn2"},
    {"text": "–ö–Ω–æ–ø–∫–∞ 3", "callback_data": "btn3"},
    {"text": "–ö–Ω–æ–ø–∫–∞ 4", "callback_data": "btn4"}
  ]
}
```

## üîÑ –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏–π

–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É –±–æ—Ç:

1. **–õ–æ–≥–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ** —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. **–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ N8N** –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–∞–∂–∞—Ç–∏–∏
3. **–í—ã–ø–æ–ª–Ω—è–µ—Ç –¥–µ–π—Å—Ç–≤–∏–µ** —Å–æ–≥–ª–∞—Å–Ω–æ callback_data
4. **–û—Ç–≤–µ—á–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é** –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º –∏–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º

### –ü—Ä–∏–º–µ—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ –±–æ—Ç–µ:

```python
def handle_callback_query(self, event):
    callback_data = event['payload']['callbackData']
    
    if callback_data == "confirm":
        self.send_text(chat_id, "‚úÖ –û–ø–µ—Ä–∞—Ü–∏—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞!")
    elif callback_data == "cancel":
        self.send_text(chat_id, "‚ùå –û–ø–µ—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞!")
```

## üéØ N8N –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –æ—Ç VK Teams:

```json
{
  "timestamp": "2025-09-28T16:17:43.227355",
  "source": "vk_teams",
  "event_type": "callback_query",
  "data": {
    "callback_data": "confirm",
    "chat_id": "user@vkteam.ru",
    "user_name": "–í–ª–∞–¥–∏–º–∏—Ä –ì—Ä–∞–≥–µ—Ä—Ç",
    "user_id": "v.graget@vkteam.ru",
    "query_id": "abc123..."
  }
}
```

### –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–Ω–æ–ø–æ–∫ –∏–∑ N8N:

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTP Request –Ω–æ–¥—É —Å URL: `http://bot:8000/api/webhook`

## üì± –ü—Ä–∏–º–µ—Ä—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤

### –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
```
–ü—Ä–∏–≤–µ—Ç! –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:

[‚ùì –°–ø—Ä–∞–≤–∫–∞] [üìä –°—Ç–∞—Ç—É—Å]
[üß™ –¢–µ—Å—Ç —ç—Ö–æ]
```

### –ú–µ–Ω—é —Å—Ç–∞—Ç—É—Å–∞  
```
ü§ñ –°—Ç–∞—Ç—É—Å –±–æ—Ç–∞: –ê–∫—Ç–∏–≤–µ–Ω
üìä –ê–∫—Ç–∏–≤–Ω—ã—Ö —á–∞—Ç–æ–≤: 5
üîó API URL: https://api.internal.myteam.mail.ru/bot/v1

[üîÑ –û–±–Ω–æ–≤–∏—Ç—å] [‚ùì –°–ø—Ä–∞–≤–∫–∞]  
[üß™ –¢–µ—Å—Ç —ç—Ö–æ]
```

### –≠—Ö–æ-–æ—Ç–≤–µ—Ç
```
–≠—Ö–æ: –í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

[üîÑ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å]
```

## üõ†Ô∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –ö–ª–∞—Å—Å InlineKeyboard

```python
from app.bot import InlineKeyboard

# –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
keyboard = InlineKeyboard()

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫
keyboard.add_button("–ö–Ω–æ–ø–∫–∞ 1", "callback_1")
keyboard.add_button("–°—Å—ã–ª–∫–∞", url="https://example.com")

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä—è–¥–∞ –∫–Ω–æ–ø–æ–∫
keyboard.add_row([
    {"text": "–î–∞", "callback_data": "yes"},
    {"text": "–ù–µ—Ç", "callback_data": "no"}
])

# –û—Ç–ø—Ä–∞–≤–∫–∞
bot.send_text(chat_id, "–í—ã–±–µ—Ä–∏—Ç–µ:", keyboard)
```

### –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π –º–µ—Ç–æ–¥

```python
# –û—Ç–ø—Ä–∞–≤–∫–∞ —Å –∫–Ω–æ–ø–∫–∞–º–∏ –Ω–∞–ø—Ä—è–º—É—é
buttons = [
    {"text": "–ü—Ä–∏–Ω—è—Ç—å", "callback_data": "accept"},
    {"text": "–û—Ç–∫–ª–æ–Ω–∏—Ç—å", "callback_data": "reject"}
]

bot.send_message_with_buttons(chat_id, "–ü—Ä–∏–Ω—è—Ç—å –∑–∞—è–≤–∫—É?", buttons)
```

## üîç –û—Ç–ª–∞–¥–∫–∞

### –õ–æ–≥–∏ —Å–æ–±—ã—Ç–∏–π –∫–Ω–æ–ø–æ–∫:
```
üîò –ù–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–∫–∏ –æ—Ç –í–ª–∞–¥–∏–º–∏—Ä –ì—Ä–∞–≥–µ—Ä—Ç –≤ —á–∞—Ç–µ v.graget@vkteam.ru: confirm
üì§ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å 2 –∫–Ω–æ–ø–∫–∞–º–∏
‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–∞–º–∏ –£–°–ü–ï–®–ù–û –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ —á–∞—Ç v.graget@vkteam.ru
```

### API Endpoints –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
- `GET /api/stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –∫–Ω–æ–ø–∫–∞—Ö
- `POST /api/send-message` - —Ç–µ—Å—Ç–æ–≤–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å –∫–Ω–æ–ø–∫–∞–º–∏
- `GET /docs` - Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API

## üéâ –ì–æ—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### –û–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
```json
{
  "message": "–û—Ü–µ–Ω–∏—Ç–µ –Ω–∞—à —Å–µ—Ä–≤–∏—Å:",
  "buttons": [
    {"text": "‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê", "callback_data": "rating_5"},
    {"text": "‚≠ê‚≠ê‚≠ê‚≠ê", "callback_data": "rating_4"},
    {"text": "‚≠ê‚≠ê‚≠ê", "callback_data": "rating_3"},
    {"text": "‚≠ê‚≠ê", "callback_data": "rating_2"},
    {"text": "‚≠ê", "callback_data": "rating_1"}
  ]
}
```

### –ú–µ–Ω—é –≤—ã–±–æ—Ä–∞
```json
{
  "message": "–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª:",
  "buttons": [
    {"text": "üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞", "callback_data": "analytics"},
    {"text": "‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏", "callback_data": "settings"},
    {"text": "üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞", "callback_data": "support"},
    {"text": "üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è", "url": "https://docs.example.com"}
  ]
}
```

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Å –ø–æ–ª–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫ VK Teams!** üöÄ
